<div class="container py-5">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="mb-4">Communities</h1>

      <!-- Sorting and Filtering Controls -->
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <label for="sortSelect" class="form-label fw-semibold">Sort by:</label>
          <select id="sortSelect" class="form-select" [(ngModel)]="sortOption" (change)="onSortChange()">
            <option value="alphabetical">Alphabetical</option>
            <option value="newest">Most Recent Activity</option>
            <option value="oldest">Least Recent Activity</option>
            <option value="most_posts">Most Posts</option>
            <option value="least_posts">Least Posts</option>
          </select>
        </div>

        <div class="col-md-6">
          <label for="filterSelect" class="form-label fw-semibold">Filter:</label>
          <select id="filterSelect" class="form-select" [(ngModel)]="filterOption" (change)="onFilterChange()">
            <option value="all">All Communities</option>
            <option value="with_posts">With Posts</option>
            <option value="without_posts">Without Posts</option>
            <option value="most_active">Most Active (5+ posts)</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <p>Loading communities...</p>
  </div>

  <!-- Communities Grid -->
  <div *ngIf="!isLoading" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let community of getFilteredCommunities()">
      <div class="card community-card h-100">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ community.name }}</h5>
          <p class="card-text flex-grow-1">A place to discuss all things related to {{ community.name | lowercase }}.</p>

          <!-- Stats -->
          <div class="community-stats mb-2">
            <span class="badge bg-primary me-2">{{ community.postCount }} posts</span>
            <span *ngIf="community.latestPostDate" class="text-muted small">
              Latest: {{ community.latestPostDate | date:'shortDate' }}
            </span>
          </div>

          <a [routerLink]="['/community', community.name]" class="btn btn-primary mt-auto">
            <i class="bi bi-arrow-right me-1"></i>Go to Community
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- No Communities Message -->
  <div *ngIf="!isLoading && getFilteredCommunities().length === 0" class="text-center py-5">
    <h3>No communities match your filter</h3>
    <p class="text-muted">Try adjusting your filter settings.</p>
  </div>
</div>
